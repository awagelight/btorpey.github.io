
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Pretty-printing in gdb with python - Confessions of a Wall Street Programmer</title>
  <meta name="author" content="Bill Torpey">

  
  <meta name="description" content="How to get python pretty-printing working with gdb">
  <meta name="keywords" content="gdb, linux, c++, redhat, centos, python">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://btorpey.github.io/blog/2016/04/16/python-pretty-printing-in-gdb">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Confessions of a Wall Street Programmer" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-61420123-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  
  <link href="/stylesheets/print.css" media="print" rel="stylesheet" type="text/css">  
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Confessions of a Wall Street Programmer</a></h1>
  
    <h2>practical ideas (and perhaps some uncommon knowledge) on software architecture, design, construction and testing</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:btorpey.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Pretty-printing in gdb with python</h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-04-16T00:00:00-04:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p><img class="left" src="/images/Holloway-Kaa-The-Jungle-Book.jpg" width="235" height="192"></p>

<p>I remember seeing Disney&rsquo;s original &ldquo;Jungle Book&rdquo; when I was a kid, and being blown away.  Not so much with the movie itself, but that music &mdash; wow!  It was probably my first exposure to any kind of jazz, and it was quite an experience.</p>

<p>One of the bad guys in the movie is Kaa the python<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>, who was really sneaky, and hypnotized his victims.</p>

<p>Recently I was installing a new version of gdb, but no matter what I did I couldn&rsquo;t get pretty-printing to work.</p>

<p>As it happens, Python was the villain here too.  Read on to see how to thwart him and get pretty-printing in your version of gdb.</p>

<!-- more -->


<p>First off, this whole ordeal was caused by the fact that I do almost all of my work on RedHat Linux (or its cousin, CentOS).  For better or worse, RedHat is the Linux of choice for many companies because of the stability of the OS, and the extended support from RedHat.</p>

<p>That stability comes at a price, though.  One way that RedHat tries to provide stability is by freezing so-called &ldquo;upstream&rdquo; packages when they create a new major version.  So, the version of gdb installed with RH6 is gdb 7.2 (which was originally released back in 2010).  The latest gdb version at the time of this writing is 7.11, so there&rsquo;s obviously been a fair amount of water over the dam by now.  Plus, gdb 7.2 can&rsquo;t debug code compiled with gcc 5, and that&rsquo;s a show-stopper.</p>

<p>So, it was time to update gdb.  How hard could that be?  Well, it looked pretty straight-forward, and the build completed successfully.  But when I ran gdb, I noticed that it was no longer &ldquo;pretty-printing&rdquo; variables.</p>

<h2>Pretty-printing in gdb with python</h2>

<p>Since about version 7, gdb has had the ability to &ldquo;pretty-print&rdquo; stl objects.  What that means is that when examining an stl object, gdb will display something more like what you would see in source code, as opposed to the internal representation of the stl object.  This is best illustrated with some example code, like the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;string&gt;</span>
</span><span class='line'><span class="cp">#include &lt;vector&gt;</span>
</span><span class='line'><span class="cp">#include &lt;map&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">hello</span> <span class="o">=</span> <span class="s">&quot;Hello, &quot;</span><span class="p">;</span>
</span><span class='line'>   <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">there</span> <span class="o">=</span> <span class="s">&quot;there!&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">hello</span><span class="p">);</span>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">there</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span>  <span class="n">m</span><span class="p">;</span>
</span><span class='line'>   <span class="n">m</span><span class="p">[</span><span class="n">hello</span><span class="p">]</span> <span class="o">=</span> <span class="n">there</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We build the program, open it in the debugger, set a breakpoint on the <code>return</code> statement, and examine the variables.</p>

<pre><code>g++ -g test.cpp
gdb a.out
b 17
r
</code></pre>

<p>Without pretty printing, the output looks like this:</p>

<pre><code>(gdb) p hello
$1 = {static npos = &lt;optimized out&gt;,
  _M_dataplus = {&lt;std::allocator&lt;char&gt;&gt; = {&lt;__gnu_cxx::new_allocator&lt;char&gt;&gt; = {&lt;No data fields&gt;}, &lt;No data fields&gt;},
    _M_p = 0x605028 "Hello, "}}
(gdb) p v
$2 = {&lt;std::_Vector_base&lt;std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::allocator&lt;std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt;&gt; = {
    _M_impl = {&lt;std::allocator&lt;std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;&gt; = {&lt;__gnu_cxx::new_allocator&lt;std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;&gt; = {&lt;No data fields&gt;}, &lt;No data fields&gt;},
      _M_start = 0x605090, _M_finish = 0x6050a0, _M_end_of_storage = 0x6050a0}}, &lt;No data fields&gt;}
(gdb) p m
$3 = {_M_t = {
    _M_impl = {&lt;std::allocator&lt;std::_Rb_tree_node&lt;std::pair&lt;std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt; &gt;&gt; = {&lt;__gnu_cxx::new_allocator&lt;std::_Rb_tree_node&lt;std::pair&lt;std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const, std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt; &gt;&gt; = {&lt;No data fields&gt;}, &lt;No data fields&gt;},
      _M_key_compare = {&lt;std::binary_function&lt;std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, bool&gt;&gt; = {&lt;No data fields&gt;}, &lt;No data fields&gt;}, _M_header = {
        _M_color = std::_S_red, _M_parent = 0x6050b0, _M_left = 0x6050b0, _M_right = 0x6050b0}, _M_node_count = 1}}}
</code></pre>

<p>But with pretty-printing enabled, the same debug session looks like this:</p>

<pre><code>(gdb) p hello
$1 = "Hello, "
(gdb) p v
$3 = std::vector of length 2, capacity 2 = {"Hello, ", "there!"}
(gdb) p m
$4 = std::map with 1 elements = {
 ["Hello, "] = "there!"
}
</code></pre>

<p>Obviously, it would be nice to get pretty-printing working again.  So, what went wrong?</p>

<h2>Building gdb <code>--with-python</code></h2>

<p>Pretty-printing with gdb requires python support enabled in gdb at build time.  I had a relatively new-ish version of python (2.7.11) installed as my default, so I figured I could just crank up a build and gdb would find it and do the right thing.  When that didn&rsquo;t work, I went back to the build and explicitly specified <code>--with-python</code> in the <code>configure</code> command &mdash; still no luck.  I tried several variations, and when none of them worked, I dug into the configure log, and found the following:</p>

<pre><code>configure:8458: checking whether to use python
configure:8460: result: yes
configure:8509: checking for python
configure:8527: found /build/share/python/2.7.10/bin/python
configure:8540: result: /build/share/python/2.7.10/bin/python
configure:8678: checking for python2.7
configure:8696: gcc -o conftest -g -O2   -I/build/share/python/2.7.10/include/python2.7 -I/build/share/python/2.7.10/include/python2.7   conftest.c -ldl -lncurses -lm -ldl    -lpthread -ldl -lutil -lm -lpython2.7 -Xlinker -export-dynamic &gt;&amp;5
/usr/bin/ld: cannot find -lpython2.7
collect2: ld returned 1 exit status
...
configure:8889: error: python is missing or unusable
</code></pre>

<p>Now I knew I had python&rsquo;s library directory on my LD_LIBRARY_PATH (<a href="#building-python">more on that later</a>), so what could the problem be?</p>

<p>Next step was to look in gdb&rsquo;s <code>confiugre.ac</code> script, where exist 326 (!) lines of code devoted solely to figuring out how to link in the python libraries.  In my case, they end up deciding to call <code>python-config --ldflags</code> and use the output of that command to set the linker flags &mdash; on my machine(s), the output is:</p>

<pre><code>$ python-config --ldflags
-lpython2.7 -lpthread -ldl -lutil -lm -Xlinker -export-dynamic
</code></pre>

<p>So that explains why the test program won&rsquo;t link &mdash; there&rsquo;s no <code>-L</code> parameter to specify the location of libpython.  (Since the configure script, apparently, properly disables linking against LD_LIBRARY_PATH).</p>

<p>So, the root cause of the problem is python-config&rsquo;s failure to report the location of the python library.  This apparently happens only when python is built with the <code>--enable-shared</code> flag &mdash; for what possible reason I can&rsquo;t imagine, but there is discussion of the problem and a patch for it <a href="https://sourceware.org/ml/gdb-patches/2010-07/msg00168.html">here</a>.  I&rsquo;m guessing that patch may have made it into the 3.x branch, but it sure ain&rsquo;t in 2.7.</p>

<p>I try <em>really</em> hard to avoid having to patch software as part of the build process &mdash; it&rsquo;s error-prone, hard to automate, and can cause problems that are extremely difficult to track down.</p>

<h2>Hacking python-config</h2>

<p>While searching for a solution, I found a post about <a href="https://sourceware.org/gdb/wiki/CrossCompilingWithPythonSupport">cross-compiling gdb</a> with python support.  (Thank you, Doug Evans!)</p>

<p>Well, the same approach works even when <em>not</em> cross-compiling, so I put together a little wrapper script for python-config that delegates to the real thing, but supplies the missing <code>-L</code> parameter.</p>

<figure class='code'><figcaption><span> (python-hack.sh)</span> <a href='/downloads/code/gdb-python/python-hack.sh'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># Copyright 2016 by Bill Torpey. All Rights Reserved.</span>
</span><span class='line'><span class="c"># This work is licensed under a Creative Commons Attribution-NonCommercial-NoDerivs 3.0 United States License.</span>
</span><span class='line'><span class="c"># http://creativecommons.org/licenses/by-nc-nd/3.0/us/deed.en</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'>
</span><span class='line'><span class="c"># fugly hack for python support</span>
</span><span class='line'><span class="c"># (see https://sourceware.org/gdb/wiki/CrossCompilingWithPythonSupport)</span>
</span><span class='line'>
</span><span class='line'><span class="nv">PYTHON_DIR</span><span class="o">=</span><span class="k">$(</span><span class="nb">cd</span> <span class="k">$(</span>dirname <span class="k">$(</span>which python<span class="k">))</span>/.. <span class="o">&amp;&amp;</span> /bin/pwd<span class="k">)</span>
</span><span class='line'><span class="c">#echo $PYTHON_DIR</span>
</span><span class='line'>
</span><span class='line'><span class="c"># The first argument is the path to python-config.py, ignore it.</span>
</span><span class='line'><span class="k">case</span> <span class="s2">&quot;$2&quot;</span> in
</span><span class='line'>   --includes<span class="o">)</span>       <span class="nb">echo</span> <span class="s2">&quot;$($PYTHON_DIR/bin/python-config --includes)&quot;</span> ;;
</span><span class='line'>   --ldflags<span class="o">)</span>        <span class="nb">echo</span> -n <span class="s2">&quot;-L$PYTHON_DIR/lib &quot;</span>; <span class="nb">echo</span> <span class="s2">&quot;$($PYTHON_DIR/bin/python-config --ldflags)&quot;</span> ;;
</span><span class='line'>   --exec-prefix<span class="o">)</span>    <span class="nb">echo</span> <span class="s2">&quot;$($PYTHON_DIR/bin/python-config --exec-prefix)&quot;</span> ;;
</span><span class='line'>   *<span class="o">)</span> <span class="nb">echo</span> <span class="s2">&quot;Bad arg $2.  Blech!&quot;</span> &gt;&amp;2 ; <span class="nb">exit </span>1 ;;
</span><span class='line'><span class="k">esac</span>
</span><span class='line'>
</span><span class='line'><span class="nb">exit </span>0
</span></code></pre></td></tr></table></div></figure>


<p>The we build gdb using the hack script instead of the installed python-config:</p>

<figure class='code'><figcaption><span> (build-gdb.sh)</span> <a href='/downloads/code/gdb-python/build-gdb.sh'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># Copyright 2016 by Bill Torpey. All Rights Reserved.</span>
</span><span class='line'><span class="c"># This work is licensed under a Creative Commons Attribution-NonCommercial-NoDerivs 3.0 United States License.</span>
</span><span class='line'><span class="c"># http://creativecommons.org/licenses/by-nc-nd/3.0/us/deed.en</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nb">set</span> -exv
</span><span class='line'>
</span><span class='line'><span class="nv">VERSION</span><span class="o">=</span>7.11
</span><span class='line'>
</span><span class='line'><span class="c"># fugly hack for python support</span>
</span><span class='line'><span class="c"># (see https://sourceware.org/gdb/wiki/CrossCompilingWithPythonSupport)</span>
</span><span class='line'><span class="nv">WITH_PYTHON</span><span class="o">=</span><span class="k">$(</span>/bin/pwd<span class="k">)</span>/python-hack.sh
</span><span class='line'>
</span><span class='line'><span class="c"># location where gcc should be installed</span>
</span><span class='line'><span class="nv">INSTALL_PREFIX</span><span class="o">=</span>/build/share/gdb/<span class="k">${</span><span class="nv">VERSION</span><span class="k">}</span>
</span><span class='line'><span class="c"># number of cores</span>
</span><span class='line'><span class="nv">CPUS</span><span class="o">=</span><span class="k">$(</span>nproc<span class="k">)</span>
</span><span class='line'><span class="c"># uncomment following to get verbose output from make</span>
</span><span class='line'><span class="c">#VERBOSE=VERBOSE=1</span>
</span><span class='line'>
</span><span class='line'><span class="o">[[</span> -e gdb-<span class="k">${</span><span class="nv">VERSION</span><span class="k">}</span>.tar.gz <span class="o">]]</span> <span class="o">||</span> wget -nv http://ftp.gnu.org/gnu/gdb/gdb-<span class="k">${</span><span class="nv">VERSION</span><span class="k">}</span>.tar.gz
</span><span class='line'>
</span><span class='line'>rm -rf gdb-<span class="k">${</span><span class="nv">VERSION</span><span class="k">}</span>
</span><span class='line'>tar xvfz gdb-<span class="k">${</span><span class="nv">VERSION</span><span class="k">}</span>.tar.gz
</span><span class='line'>
</span><span class='line'>rm -rf build
</span><span class='line'>mkdir build
</span><span class='line'><span class="nb">cd </span>build
</span><span class='line'>../gdb-<span class="k">${</span><span class="nv">VERSION</span><span class="k">}</span>/configure --prefix<span class="o">=</span><span class="k">${</span><span class="nv">INSTALL_PREFIX</span><span class="k">}</span> --with-python<span class="o">=</span><span class="k">${</span><span class="nv">WITH_PYTHON</span><span class="k">}</span>
</span><span class='line'>make -j <span class="k">${</span><span class="nv">CPUS</span><span class="k">}</span> <span class="k">${</span><span class="nv">VERBOSE</span><span class="k">}</span>
</span><span class='line'>
</span><span class='line'><span class="c"># install it</span>
</span><span class='line'>rm -rf <span class="k">${</span><span class="nv">INSTALL_PREFIX</span><span class="k">}</span>
</span><span class='line'>make install
</span></code></pre></td></tr></table></div></figure>


<p>Now, we&rsquo;ve got pretty-printing back!</p>

<pre><code>(gdb) p hello
$1 = "Hello, "
(gdb) p v
$3 = std::vector of length 2, capacity 2 = {"Hello, ", "there!"}
(gdb) p m
$4 = std::map with 1 elements = {
 ["Hello, "] = "there!"
}
</code></pre>

<h2>Some notes on gdb</h2>

<p>Even if pretty-printing is enabled, you can still get to the underlying data structure if you need to:</p>

<pre><code>(gdb) p /r hello
$2 = {static npos = 18446744073709551615,
  _M_dataplus = {&lt;std::allocator&lt;char&gt;&gt; = {&lt;__gnu_cxx::new_allocator&lt;char&gt;&gt; = {&lt;No data fields&gt;}, &lt;No data fields&gt;}, _M_p = 0x601028 "Hello, world!"}}
</code></pre>

<p>Don&rsquo;t confuse the gdb <code>set print pretty on</code> command with python pretty-printing.  All that <code>set print pretty</code> does is indent structure members, rather than printing the whole thing on a single line, like so:</p>

<pre><code>(gdb) set print pretty on
(gdb) p /r hello
$3 = {
  static npos = 18446744073709551615,
  _M_dataplus = {
    &lt;std::allocator&lt;char&gt;&gt; = {
      &lt;__gnu_cxx::new_allocator&lt;char&gt;&gt; = {&lt;No data fields&gt;}, &lt;No data fields&gt;},
    members of std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;::_Alloc_hider:
    _M_p = 0x601028 "Hello, world!"
  }
}
</code></pre>

<p>You may run across instructions on the intertubes (e.g., <a href="https://sourceware.org/gdb/wiki/STLSupport">here</a>) that talk about changing your <code>.gdbinit</code> to manually import the python drivers needed for pretty-printing.  These instructions appear to be obsolete, at least with the most recent version of gdb (7.11) &mdash; pretty-printing works automagically, and no special configuration is required.</p>

<p><a id="building-python"></a></p>

<h2>A note on building python</h2>

<p>The default python on RH6 is version 2.6, and a lot of packages don&rsquo;t support anything older than 2.7.  So, I built a recent 2.7 version from source, but when I tried to run it I would get:</p>

<pre><code>python: error while loading shared libraries: libpython2.7.so.1.0: cannot open shared object file: No such file or directory
</code></pre>

<p>So, I added the python lib directory to LD_LIBRARY_PATH, but I didn&rsquo;t feel right about it &mdash; most commands don&rsquo;t require that.</p>

<p>Thanks to <a href="http://stackoverflow.com/a/32558660/203044">this post</a>, I modified the build script to include an <a href="https://gcc.gnu.org/ml/gcc-help/2005-12/msg00017.html">RPATH</a> in the python executable that eliminated the need to put the python lib directory on LD_LIBRARY_PATH.  Here&rsquo;s the python build script:</p>

<figure class='code'><figcaption><span> (build-python.sh)</span> <a href='/downloads/code/gdb-python/build-python.sh'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># Copyright 2016 by Bill Torpey. All Rights Reserved.</span>
</span><span class='line'><span class="c"># This work is licensed under a Creative Commons Attribution-NonCommercial-NoDerivs 3.0 United States License.</span>
</span><span class='line'><span class="c"># http://creativecommons.org/licenses/by-nc-nd/3.0/us/deed.en</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nb">set</span> -exv
</span><span class='line'>
</span><span class='line'><span class="nv">VERSION</span><span class="o">=</span>2.7.11
</span><span class='line'>
</span><span class='line'><span class="c">## modify the following as needed for your environment</span>
</span><span class='line'><span class="c"># location where gcc should be installed</span>
</span><span class='line'><span class="nv">INSTALL_PREFIX</span><span class="o">=</span>/build/share/python/<span class="k">${</span><span class="nv">VERSION</span><span class="k">}</span>
</span><span class='line'><span class="c"># number of cores</span>
</span><span class='line'><span class="nv">CPUS</span><span class="o">=</span>1
</span><span class='line'><span class="c"># uncomment following to get verbose output from make</span>
</span><span class='line'><span class="c">#VERBOSE=VERBOSE=1</span>
</span><span class='line'>
</span><span class='line'><span class="c">## download</span>
</span><span class='line'><span class="o">[[</span> -e Python-<span class="k">${</span><span class="nv">VERSION</span><span class="k">}</span>.tgz <span class="o">]]</span>   <span class="o">||</span> wget -nv https://www.python.org/ftp/python/<span class="k">${</span><span class="nv">VERSION</span><span class="k">}</span>/Python-<span class="k">${</span><span class="nv">VERSION</span><span class="k">}</span>.tgz
</span><span class='line'>
</span><span class='line'><span class="c">## untar</span>
</span><span class='line'>rm -rf Python-<span class="k">${</span><span class="nv">VERSION</span><span class="k">}</span>
</span><span class='line'>tar xf Python-<span class="k">${</span><span class="nv">VERSION</span><span class="k">}</span>.tgz
</span><span class='line'>
</span><span class='line'><span class="c"># build</span>
</span><span class='line'><span class="nb">cd </span>Python-<span class="k">${</span><span class="nv">VERSION</span><span class="k">}</span>
</span><span class='line'>./configure --prefix<span class="o">=</span><span class="k">${</span><span class="nv">INSTALL_PREFIX</span><span class="k">}</span> --enable-shared <span class="se">\</span>
</span><span class='line'><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">&quot;-Wl,--rpath=${INSTALL_PREFIX}/lib&quot;</span>
</span><span class='line'>
</span><span class='line'>make -j <span class="k">${</span><span class="nv">CPUS</span><span class="k">}</span> <span class="k">${</span><span class="nv">VERBOSE</span><span class="k">}</span>
</span><span class='line'>
</span><span class='line'><span class="c"># install it</span>
</span><span class='line'>rm -rf <span class="k">${</span><span class="nv">INSTALL_PREFIX</span><span class="k">}</span>
</span><span class='line'>make install
</span></code></pre></td></tr></table></div></figure>


<h2>Conclusion</h2>

<p>It seems that quite a few people have had similar difficulties getting pretty-printing working as I did, so I hope this longish explanation is helpful.  And many thanks to all the people who took the trouble to share their own problems and solutions getting python pretty-printing to work with gdb.</p>

<p>As always, please leave a comment below (preferred), or  <a href="mailto:wallstprog@gmail.com">contact me</a>
directly with comments, suggestions, corrections, etc.</p>

<h2>Footnotes</h2>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>Voiced by Sterling Holloway, who was also the voice of Winnie the Pooh.  Go figure.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Bill Torpey</span></span>

      








  


<time datetime="2016-04-16T00:00:00-04:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/c-plus-plus/'>c++</a>, <a class='category' href='/blog/categories/linux/'>linux</a>, <a class='category' href='/blog/categories/tools/'>tools</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://btorpey.github.io/blog/2016/04/16/python-pretty-printing-in-gdb/" data-via="wallstprog" data-counturl="http://btorpey.github.io/blog/2016/04/16/python-pretty-printing-in-gdb/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/10/13/remote-scripting-with-bash-and-ssh/" title="Previous Post: Remote Scripting with bash and ssh">&laquo; Remote Scripting with bash and ssh</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/04/16/python-pretty-printing-in-gdb/">Pretty-printing in gdb with python</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/13/remote-scripting-with-bash-and-ssh/">Remote Scripting with bash and ssh</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/27/static-analysis-with-clang/">Static Analysis with clang</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/17/shadow/">Who Knows What Evil Lurks ...</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/02/building-clang/">Building clang on RedHat</a>
      </li>
    
  </ul>
</section>
<section>
  
  <a href="/about/index.html"><h1>About...</h1></a>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
Copyright &copy; 2016 - Bill Torpey. &nbsp; All Rights Reserved.
<br>
<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a> This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/deed.en_US">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.
<br>
<span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'wallstprog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://btorpey.github.io/blog/2016/04/16/python-pretty-printing-in-gdb/';
        var disqus_url = 'http://btorpey.github.io/blog/2016/04/16/python-pretty-printing-in-gdb/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
